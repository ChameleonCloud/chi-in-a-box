prometheus_docker_network_name: prometheus

enable_prometheus_alertmanager: yes
# This should be encrypted! It is a secret value.
prometheus_alertmanager_slack_api_url: "{{ slack_api_url }}"
prometheus_alertmanager_users:
  - jakecoll
  - jason_a

prometheus_mysql_exporter_user: mysqld-exporter

prometheus_openstack_exporter_user: admin

prometheus_services:
  server:
    service_name: prometheus_server
    image: prom/prometheus:v2.3.2
    group: prometheus
    restart_handler: restart prometheus
    port: 9090
    config_dir: /etc/prometheus
    scrape_target: yes
    volumes:
      - "prometheus-data:/prometheus"
      - "/etc/prometheus:/etc/prometheus"
  alertmanager:
    service_name: prometheus_alertmanager
    image: prom/alertmanager:v0.15.2
    group: prometheus-alertmanager
    restart_handler: restart alertmanager
    port: 9093
    config_dir: /etc/alertmanager
    service_args:
      - "--web.external-url=https://{{ prometheus_alertmanager_hostname }}"
    scrape_target: no
    volumes:
      - "alertmanager-data:/alertmanager"
      - "/etc/alertmanager:/etc/alertmanager"
  apache-exporter:
    service_name: prometheus_apache_exporter
    image: docker.chameleoncloud.org/apache_exporter:77c9bc9
    group: prometheus-apache-exporter
    restart_handler: restart apache exporter
    port: 9117
    service_args:
      - "-scrape_uri http://{{ ansible_internal_ipv4_addresses[inventory_hostname] }}/server-status?auto"
    scrape_target: yes
  ceph-exporter:
    service_name: prometheus_ceph_exporter
    image: digitalocean/ceph_exporter:2.0.0-luminous
    group: prometheus-ceph-exporter
    restart_handler: restart ceph exporter
    port: 9128
    config_dir: /etc/ceph
    scrape_target: yes
    volumes:
      - "/etc/ceph:/etc/ceph"
  jupyterhub-exporter:
    group: jupyterhub
    port: 8075
    scrape_target: yes
  mysql-exporter:
    service_name: prometheus_mysql_exporter
    image: prom/mysqld-exporter:v0.11.0
    group: prometheus-mysqld-exporter
    restart_handler: restart mysql exporter
    port: 9104
    config_dir: /etc/prometheus/mysqld-exporter
    scrape_target: yes
    volumes:
      - "/etc/prometheus/mysqld-exporter/my.cnf:/root/.my.cnf"
  node-exporter:
    service_name: prometheus_node_exporter
    group: prometheus-node-exporter
    restart_handler: restart node exporter
    custom_service: yes
    port: 9100
    bin_path: /usr/sbin
    bin_url: https://github.com/prometheus/node_exporter/releases/download/v0.16.0/node_exporter-0.16.0.linux-amd64.tar.gz
    scrape_target: yes
  openstack-exporter:
    service_name: prometheus_openstack_exporter
    image: docker.chameleoncloud.org/prometheus-openstack-exporter:latest
    group: prometheus-openstack-exporter
    restart_handler: restart openstack exporter
    port: 9103
    config_dir: /etc/prometheus
    env_file: /etc/prometheus/openstack_exporter.env
    scrape_target: yes
    volumes:
      - "/etc/prometheus/openstack_exporter.yml:/usr/local/bin/exporter/config.yml"
  snmp-exporter:
     service_name: prometheus_snmp_exporter
     image: prom/snmp-exporter:v0.15.0
     generator_image: prom/snmp-generator:master
     group: prometheus-snmp-exporter
     restart_handler: restart snmp exporter
     port: 9116
     config_dir: /etc/prometheus/snmp-exporter
     scrape_target: no
     volumes:
       - "/etc/prometheus/snmp-exporter:/etc/snmp_exporter"
