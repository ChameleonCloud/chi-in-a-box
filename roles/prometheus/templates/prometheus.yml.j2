---
global:
  scrape_interval:     30s
  evaluation_interval: 30s

# Alertmanager configuration
# alerting:
#   alertmanagers:
#   - static_configs:
#     - targets:
#       - alertmanager:9093

# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
rule_files:
  - "/etc/prometheus/*-rules.yml"

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:
  - job_name: 'prometheus'
    static_configs:
    - targets: ['localhost:9090']
{% if node_exporters is defined %}
  {% for host in node_exporters %}
    - job_name: '{{ host }}-node'
      static_configs:
        - targets: ['{{ node_exporters[host] }}:9100']
          labels:
            hostname: '{{ host }}'
  {% endfor %}
{% endif %}
{% if ceph_exporters is defined %}
  {% for host in ceph_exporters %}
    - job_name: '{{ host }}-ceph'
      static_configs:
        - targets: ['{{ ceph_exporters[host] }}']
          labels:
            hostname: '{{ host }}'
  {% endfor %}
{% endif %}
{% if mysql_exporter is defined %}
  {% for host in mysql_exporters %}
    - job_name: '{{ host }}-mysql'
      static_configs:
        - targets: ['{{ mysql_exporters[host] }}']
          labels:
            hostname: '{{ host }}'
  {% endfor %}
{% endif %}
{% if openstack_exportes is defined %}
{% for host in openstack_exporters %}
  - job_name: '{{ host }}-openstack'
    static_configs:
      - targets: ['{{ openstack_exporters[host] }}']
        labels:
          hostname: '{{ host }}'
{% endfor %}
{% endif %}