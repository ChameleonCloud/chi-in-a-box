from openstack_dashboard.settings import HORIZON_CONFIG
from os import environ

# Kolla-ansible defaults this to 'internalURL', which doesn't work when
# we need to access another region from across the public internet. Need
# to unfortunately default to 'public' interface for all endpoints as it is
# not currently possible (?) to use a different value here depending on which
# region is being used.
OPENSTACK_ENDPOINT_TYPE = 'publicURL'

# Default user to specific region on login.
DEFAULT_SERVICE_REGIONS = {
  '{{ horizon_keystone_url }}': '{{ openstack_region_name }}',
}

SITE_BRANDING = 'ChameleonCloud'

# Override help menu to point to our docs.
HORIZON_CONFIG['help_url'] = '{{ horizon_help_url }}'

{% if enable_blazar | bool %}
# Blazar-specific settings
{% if blazar_floatingip_reservation_network_regex is defined %}
OPENSTACK_BLAZAR_FLOATINGIP_RESERVATION = {
  # Allow reserving floating IPs on this network
  'network_name_regex': '{{ blazar_floatingip_reservation_network_regex }}'
}
{% endif %}
# Used for Blazar dashboard, which needs to pull data from the MySQL database
# directly at the moment.
DATABASES = {
  'default': {},
{% for conf in horizon_regions %}
{% if conf.blazar_database_host is defined %}
  'blazar-{{ conf.region_name }}': {
    'ENGINE': 'django.db.backends.mysql',
    'NAME': '{{ conf.blazar_database_name }}',
    'HOST': '{{ conf.blazar_database_host }}',
    'PORT': '{{ conf.blazar_database_port }}',
    'USER': '{{ conf.blazar_database_user }}',
    'PASSWORD': '{{ conf.blazar_database_password }}',
  },
{% endif %}
{% endfor %}
}
{% endif %}

# Add default Chameleon theme.
AVAILABLE_THEMES = [
  ('default', 'Default', 'themes/default'),
  ('chameleoncloud', 'ChameleonCloud', '/etc/openstack-dashboard/themes/chameleoncloud'),
]
DEFAULT_THEME = 'chameleoncloud'

# Used by server instance page to create links from the instance overview
# to the resource catalog.
CHAMELEON_PORTAL_API_BASE_URL = 'https://www.chameleoncloud.org'
CHAMELEON_SITES = {
{% for conf in horizon_regions %}
  '{{ conf.region_name }}': '{{ conf.chameleon_site_name }}',
{% endfor %}
}

{% if enable_horizon_chameleon_websso | bool %}
# Single-sign on support
WEBSSO_ENABLED = True
AUTHENTICATION_URLS = ['openstack_dashboard.cc_web_sso_urls','openstack_auth.urls',]
CHAMELEON_PORTAL_SSO_BASE_URL = '{{ horizon_chameleon_websso_host }}'
CHAMELEON_PORTAL_SSO_LOGIN_PATH = '/sso/horizon/'
CHAMELEON_PORTAL_SSO_LOGOUT_PATH = '/logout/'
SSO_CALLBACK_HOST = '{{ kolla_external_fqdn }}'
{% endif %}

# A dictionary of settings which can be used to provide the default values for
# properties found in the Launch Instance modal.
LAUNCH_INSTANCE_DEFAULTS = {
    'create_volume': False,
}

# [2020-02-05 diurnalist]
# TODO: solve the root problem here and re-enable this extension.
# Turn off SimpleTenantUsage extension, which has caused severe performance
# penalties in our version of Horizon. This makes the little table on the
# main dashboard page, which shows a list of recent instances, not show up.
# The API calls to Nova to populate this UI were going through an endless loop,
# clogging up server resources.
OPENSTACK_NOVA_EXTENSIONS_BLACKLIST = [
    'SimpleTenantUsage',
]

# The OPENSTACK_IMAGE_BACKEND settings can be used to customize features
# in the OpenStack Dashboard related to the Image service, such as the list
# of supported image formats.
OPENSTACK_IMAGE_BACKEND = {
    'image_formats': [
        ('qcow2', 'QCOW2 - QEMU Emulator'),
        ('raw', 'Raw'),
    ],
}
